<!DOCTYPE html>
<html>
    <head>
        <script src="https://aframe.io/releases/0.5.0/aframe.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Denk+One" rel="stylesheet">
    </head>
    <body>

      <!-- ========= Screen load ========= -->
       <div id='loader' style='position: fixed; left: 0px; top: 0px; width: 100%; height: 100%; z-index: 9999; background-color: white; text-align: center;'>
         <img id='img'src='img/logo-supersolvers.png' style="height: 200px; margin-top: 10%"></img>
         <p style="font-size: 20px; font-family: 'Denk One', sans-serif;">Loading...</p>
       </div>

      <a-scene inspector="url: https://aframe.io/releases/0.3.0/aframe-inspector.min.js">
        <a-assets>
          <a-asset-item id='object' src='models/aztec-temple.obj'></a-asset-item>
          <a-asset-item id='material' src='models/aztec-temple.mtl'></a-asset-item>
          <a-asset-item id='lion-obj' src='models/lion/lion-cub.obj'></a-asset-item>
          <a-asset-item id='lion-mtl' src='models/lion/lion-cub.mtl'></a-asset-item>
          <a-asset-item id='orange-texture' src='models/orange.jpeg'></a-asset-item>
        </a-assets>

        <a-sky src="https://upload.wikimedia.org/wikipedia/commons/6/6f/Helvellyn_Striding_Edge_360_Panorama,_Lake_District_-_June_09.jpg"></a-sky>

        <!-- ========= Screen Blackout ========= -->
        <div id='overlay' style='background: white; display: none; width: 100%; height: 100%; position:absolute; top:0; left:0; z-index:99998;'></div>

        <!-- ========= Portal ========= -->
        <a-sphere id='portal' src='models/portal.png' visible="false" position="2 1.8 -4" radius="0.5" scale="0.1 0.1 0.1">
          <a-animation
              attribute="rotation"
               dur="500"
               from="0 0 0"
               to="0 360 0"
               repeat="indefinite"
               easing="linear">
          </a-animation>

           <a-animation
            attribute="scale"
            dur="2000"
            from="0.1 0.1 0.1"
            to="1 2 1"
            easing="linear"
            begin="expand">
          </a-animation>

          <a-animation
           attribute="position"
           dur="1000"
           from="2 1.8 -4"
           to="-.5 1 1"
           easing="linear"
           begin="next_page">
         </a-animation>
        </a-sphere>

        <!-- ========= Lion textbox ========= -->
        <a-entity id='text' scale=.1 geometry="primitive: plane; radius: 2; width: auto; height: 1; depth: 2" visible='false' text="value: I'm so hungry... what can I eat around here?; align: center; width: 2; wrap-count: 20; color: #333333" position="-1.64 2.76 -5.73" rotation='0 30 0' material="color: white" >
          <a-animation
           attribute="scale"
           dur="500"
           from="0.1 0.1 0.1"
           to="1 1 1"
           easing="linear"
           begin="text_expand">
         </a-animation>
        </a-entity>

        <!-- ========= Models ========= -->
        <a-obj-model src='#object' mtl='#material'></a-obj-model>
        <a-obj-model id='lion' src="#lion-obj" mtl="#lion-mtl" rotation="180 30 180" scale=".2 .2 .2" position="-2 1.2 -5"></a-obj-model>
        <a-sphere id='orange' visible='false' src="#orange-texture" radius="0.1" position="2 1.5 -1.2" scale="0.3 0.3 0.3"></a-sphere>

        <a-camera position='0 0 0'>
          <a-cursor color='red'></a-cursor>
          <a-sphere id='key' visible='false' src="#orange-texture" radius="0.1" position="0.25 -0.15 -0.3" rotation="180 90 180"></a-sphere>
        </a-camera>

      </a-scene>

      <script src="https://unpkg.com/aframe-event-set-component@3.x.x/dist/aframe-event-set-component.min.js"></script>
      <script>

      // Start loading screen
       $(window).load(function() {
         $(this).data('timeout', setTimeout(function(){
           $("#loader").fadeOut("slow");
         }, 2000))
       })

      var lion = document.querySelectorAll('#lion')
      var haveGem = false
      var portal = document.getElementById('portal')

      // Lion textbox action
      lion.forEach(function(element){
        element.addEventListener( 'mouseenter', function() {
          debugger
          document.querySelector('#text').setAttribute("visible", true)
          document.querySelector('#text').emit('text_expand')
          document.querySelector('#orange').setAttribute("visible", true)
        })
      })

      // Grab orange action
      if (haveGem === false) {
        document.querySelector('#orange').addEventListener( 'mouseenter', function() {
          document.querySelector('#key').setAttribute("visible", true)
          document.querySelector('#orange').setAttribute("visible", false)
          haveGem = true
          document.querySelector('#lion').addEventListener( 'mouseenter', function() {
            document.querySelector('#orange').setAttribute("position", "-1 1.45 -4.75")
            document.querySelector('#orange').setAttribute("scale", "1 1 1")
            document.querySelector('#orange').setAttribute("visible", true)
            document.querySelector('#key').setAttribute("visible", false)
            document.querySelector('#text').setAttribute("text", "value: Thanks!\n I'm trying to find the right portal home... come along!; align: center; width: 2; wrap-count: 20; color: #333333")
            document.querySelector('#portal').setAttribute('visible', true)
            document.querySelector('#portal').emit('expand')

            setTimeout(function(){
              document.querySelector('#orange').setAttribute("visible", false)
            }.bind(this), 1000)
          })
        })
      }

      // Next level action
      document.getElementById('portal').addEventListener('mouseenter', function(event){
        $(this).css('z-index','99999');
        $('#overlay').fadeIn(1000);
        portal.emit('next_page')
        $(this).data('timeout', setTimeout(function(){
          window.open("level1.html", "_self")
        }, 1000));
        $('#overlay').fadeOut(1000);
      });

      </script>
    </body>
</html>
