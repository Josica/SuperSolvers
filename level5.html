<!DOCTYPE html>
<html>
    <head>
        <script src="https://aframe.io/releases/0.5.0/aframe.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
        <script src="https://rawgit.com/ngokevin/aframe-animation-component/master/dist/aframe-animation-component.min.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Denk+One" rel="stylesheet">
    </head>
    <body>

      <!-- ========= Screen load ========= -->
         <div id='loader' style='position: fixed; left: 0px; top: 0px; width: 100%; height: 100%; z-index: 9999; background-color: white; text-align: center;'>
           <img id='img'src='img/logo-supersolvers.png' style="height: 200px; margin-top: 10%"></img>
           <p style="font-size: 20px; font-family: 'Denk One', sans-serif;">Loading...</p>
         </div>

         <!-- ========= Screen Blackout ========= -->
         <div id='overlay' style='background: white; display: none; width: 100%; height: 100%; position:absolute; top:0; left:0; z-index:99998;'></div>

         <div id='wrong_overlay' style='background: black; display: none; width: 100%; height: 100%; position:absolute; top:0; left:0; z-index:99998;'></div>


      <a-scene inspector="url: https://aframe.io/releases/0.3.0/aframe-inspector.min.js">

        <!-- ASSETS -->
        <a-assets>
          <a-asset-item id='lion-obj' src='models/lion/lion-cub.obj'></a-asset-item>
          <a-asset-item id='lion-mtl' src='models/lion/lion-cub.mtl'></a-asset-item>
          <a-asset-item id='fish-obj' src='models/fish/fish.obj'></a-asset-item>
          <a-asset-item id='fish-mtl' src='models/fish/fish.mtl'></a-asset-item>
          <a-asset-item id='chest-obj' src='models/chest/animated-chest.obj'></a-asset-item>
          <a-asset-item id='chest-mtl' src='models/chest/animated-chest.mtl'></a-asset-item>
        </a-assets>

        <!-- SKY -->
        <a-sky src="img/sea.jpg"></a-sky>

        <!-- TREASURE CHEST -->
        <a-obj-model id='chest' src="#chest-obj" mtl="#chest-mtl" visible='false' rotation="0 0 -15" scale="20 20 20" position="-100 15 -60"></a-obj-model>

        <!-- COIN ONE (1/3) -->
       <a-cylinder id='coin1' class="coin" src='img/onethird.png' visible='false' position="-30 36 -65" rotation="200 -40 90" radius="1" height=".2" scale="5 5 5" animation="property: position; dir: alternate; dur: 1000;easing: easeInSine; loop: true; to: -30 38 -65">
       <a-animation
         attribute="radius"
         dur="2000"
         from="1"
         to="1.5"
         easing="linear"
         begin="select">
       </a-animation>

       <a-animation
         attribute="radius"
         from="1"
         to="1"
         easing="linear"
         begin="deselect">
       </a-animation>
       </a-cylinder>

       <!-- COIN TWO (1/9) -->
       <a-cylinder id='coin2' class="coin" src='img/oneninth.png' visible='false' position="-36 25 -52" rotation="200 -40 90" radius="1" height=".2" scale="5 5 5" animation="property: position; dir: alternate; dur: 1000;easing: easeInSine; loop: true; to: -36 28 -52">
         <a-animation
            attribute="radius"
            dur="1000"
            from="1"
            to="1.5"
            easing="linear"
            begin="select">
         </a-animation>

         <a-animation
            attribute="radius"
            from="1"
            to="1"
            easing="linear"
            begin="deselect">
         </a-animation>
       </a-cylinder>

       <!-- COIN THREE (3/1) -->
       <a-cylinder id='coin3' class="coin" src='img/three.png' visible='false' position="-30 20 -70" rotation="200 -40 90" radius="1" height=".2" scale="5 5 5" animation="property: position; dir: alternate; dur: 1000;easing: easeInSine; loop: true; to: -30 22 -70">
         <a-animation
            attribute="radius"
            dur="1000"
            from="1"
            to="1.5"
            easing="linear"
            begin="select">
         </a-animation>

         <a-animation
            attribute="radius"
            from="1"
            to="1"
            easing="linear"
            begin="deselect">
         </a-animation>
       </a-cylinder>

        <a-sphere id="bubble"opacity="0.2" color="white" radius="7" position="-26 7.2 -5" rotation="190 65 180">

        <a-obj-model id='lion' src="#lion-obj" mtl="#lion-mtl" rotation="180 190 180" scale="1.3 1.3 1.3" position="5.5 0.1 0.3"></a-obj-model>
        </a-sphere>

        <a-sphere id="bubbles1"opacity="0.2" color="white" radius="1" position="-26 19.2 -1" rotation="190 65 180" animation="property: position; dur: 7500; easing: linear; loop: true; to: 0 360 0; delay:1000">
        </a-sphere>

        <a-sphere id="bubbles2"opacity="0.2" color="white" radius="0.5" position="-5 0.2 -1" rotation="190 65 180" animation="property: position; dur: 7500; easing: linear; loop: true; to: 0 360 0; delay:7000">
        </a-sphere>

        <a-sphere id="bubbles3"opacity="0.2" color="white" radius="1" position="0 1 -1" rotation="190 65 180" animation="property: position; dur: 7550; easing: linear; loop: true; to: 0 360 0; delay:9000">
        </a-sphere>

        <a-sphere id="bubbles4"opacity="0.2" color="white" radius="0.5" position="26 -19.2 -1" rotation="190 65 180" animation="property: position; dur: 7500; easing: linear; loop: true; to: 0 360 0;delay:4000">
        </a-sphere>

        <a-sphere id="bubbles5"opacity="0.2" color="white" radius="1" position="45 -30 -1" rotation="190 65 180" animation="property: position; dur: 8550; easing: linear; loop: true; to: 0 360 0;delay:2000">
        </a-sphere>

        <a-sphere id="bubbles6"opacity="0.2" color="white" radius="0.5" position="96 19.2 -1" rotation="190 65 180" animation="property: position; dur: 7500; easing: linear; loop: true; to: 0 360 0; delay:5000">
        </a-sphere>

        <a-sphere id="bubbles7"opacity="0.2" color="white" radius="1" position="-51 0.2 -1" rotation="190 65 180" animation="property: position; dur: 7550; easing: linear; loop: true; to: 0 360 0;delay:6000">
        </a-sphere>

        <a-sphere id="bubbles8"opacity="0.2" color="white" radius="0.5" position="56 1 -1" rotation="190 65 180" animation="property: position; dur: 7550; easing: linear; loop: true; to: 0 360 0; delay:4000">
        </a-sphere>

        <a-sphere id="bubbles9"opacity="0.2" color="white" radius="1" position="2 -19.2 -1" rotation="190 65 180" animation="property: position; dur: 7500; easing: linear; loop: true; to: 0 360 0; delay:5000">
        </a-sphere>

        <a-sphere id="bubbles10"opacity="0.2" color="white" radius="0.5" position="5.5 7.45 30.3" rotation="190 65 180" animation="property: position; dur: 8550; easing: linear; loop: true; to: 0 360 0; delay:2000">
        </a-sphere>

        <a-sphere id="bubbles11"opacity="0.2" color="white" radius="0.5" position="0.5 0.1 0.3" rotation="190 65 180" animation="property: position; dur: 8550; easing: linear; loop: true; to: 0 360 0; delay:5000">
        </a-sphere>

        <a-sphere id="bubbles12"opacity="0.2" color="white" radius="0.5" position="-256 180.45 260.3" rotation="190 65 180" animation="property: position; dur: 7550; easing: linear; loop: true; to: 0 360 0; delay:2000">
        </a-sphere>

        <a-sphere id="bubbles12"opacity="0.2" color="white" radius="0.5" position="20 180.45 260.3" rotation="190 65 180" animation="property: position; dur: 7580; easing: linear; loop: true; to: 0 360 0; delay:1000">
        </a-sphere>

        <a-obj-model id ="1-yellowfish1" src='#fish-obj' color='#ffe000' rotation="180 190 180" scale="0.02 0.02 0.02" position="5.5 0.1 0.3"></a-obj-model>
        <a-obj-model id ="2-greenfish1" src='#fish-obj' color='#578205' rotation="180 190 180" scale="0.02 0.02 0.02" position="5.5 7.45 9.3"></a-obj-model>
        <a-obj-model id ="3-orangefish1" src='#fish-obj' color='#feab2a' rotation="190 90 180" scale="0.1 0.1 0.1" position="-29 46 -24"></a-obj-model>
        <a-obj-model id ="4-redfish1" src='#fish-obj' color='#ff0000' rotation="190 90 180" scale="2 2 2" position="280 998 -117"></a-obj-model>
        <a-obj-model id ="5-purplefish1" src='#fish-obj' color='#d79dfc' rotation="190 90 180" scale="2 2 2" position="-576 2.57 1178.3"></a-obj-model>
        <a-obj-model id ="6-salmonfish1" src='#fish-obj' color='#f89173' rotation="180 190 180" scale="0.02 0.02 0.02" position="0.5 0.1 0.3"></a-obj-model>
        <a-obj-model id ="7-redfish2" src='#fish-obj' color='#ff0000' rotation="190 90 180" scale="0.9 0.9 0.9" position="-200 -300 -145"></a-obj-model>
        <a-obj-model id ="8-purplefish1" src='#fish-obj' color='#d79dfc' rotation="190 90 180" scale="2 2 2" position="548 705 -422"></a-obj-model>
        <a-obj-model id ="9-redfish3" src='#fish-obj' color='#ff0000' rotation="180 190 180" scale="0.02 0.02 0.02" position="0 0.1 2"></a-obj-model>

        <a-entity id='text' scale="6 6 6" geometry="primitive: plane; radius: 2; width: 2.3; height: 1.8; depth: 2" visible='false' text="value:I see nine solid colored fish. Can you help me figure out how many are solid red? When you think you know, hover over the chest, and select the correct coin that will unlock the next portal.; align: center; width: 2; wrap-count: 20; color: #333333" position="-20 18 -10" rotation='0 60 0' material="color: white" >
        </a-entity>

        <!-- ========= Portal ========= -->
        <a-sphere id='portal' src='models/portal.png' visible="false" position="-11.4 21 -67" radius="1" scale="6 15 6">
          <a-animation
              attribute="rotation"
               dur="500"
               from="0 0 0"
               to="0 360 0"
               repeat="indefinite"
               easing="linear"></a-animation>

           <a-animation
            attribute="scale"
            dur="2000"
            from="0.1 0.1 0.1"
            to="7 14 7"
            easing="linear"
            begin="expand">
          </a-animation>

          <a-animation
           attribute="position"
           dur="1000"
           from="-11.4 21 -67"
           to="-.2 1 -10.6"
           easing="linear"
           begin="next_page">
         </a-animation>
        </a-sphere>

        <!-- Wrong portal -->
        <a-sphere id='bad_portal' color='black' src='models/portal.png' visible="false" position="-11.4 21 -67" radius="1" scale="6 15 6">
          <a-animation
              attribute="rotation"
               dur="500"
               from="0 0 0"
               to="0 360 0"
               repeat="indefinite"
               easing="linear"></a-animation>

           <a-animation
            attribute="scale"
            dur="2000"
            from="0.1 0.1 0.1"
            to="7 14 7"
            easing="linear"
            begin="expand">
          </a-animation>

          <a-animation
           attribute="position"
           dur="1000"
           from="-11.4 21 -67"
           to="-.2 1 -10.6"
           easing="linear"
           begin="next_page">
         </a-animation>
        </a-sphere>


        <a-camera position='0 0 0'>
          <a-cursor color='white'></a-cursor>
        </a-camera>

      </a-scene>


      <script>

      // Start loading screen
        $(window).load(function() {
          $("#img").fadeIn("slow");
          $(this).data('timeout', setTimeout(function(){
            $("#loader").fadeOut("slow");
          }, 3000))
        })

      var lion = document.querySelector('#lion')
      var coin1 = document.querySelector('#coin1')

      // get instructions from lion
      document.querySelector('#bubble').addEventListener('mouseenter', function() {
          document.querySelector('#text').setAttribute("visible", true)
          document.querySelector('#chest').setAttribute("visible", true)
      })
      document.querySelector('#chest').addEventListener('mouseenter', function() {
          document.querySelector('#coin1').setAttribute("visible", true)
          document.querySelector('#coin2').setAttribute("visible", true)
          document.querySelector('#coin3').setAttribute("visible", true)
      })

      //correct coin
      function correctAnswer() {
          coin1.emit('select')
          $(this).data('timeout', setTimeout(function(){
            document.querySelector('#portal').setAttribute('visible', true)
            document.querySelector('#portal').emit('expand')
            coin1.removeEventListener('mouseenter', correctAnswer);
          }, 2000));
      }

      function correctAnswerLeave() {
        coin1.emit('deselect')
        clearTimeout($(this).data('timeout'));
      }

      coin1.addEventListener('mouseenter', correctAnswer);
      coin1.addEventListener('mouseleave', correctAnswerLeave);

      // Correct answer redirect
      document.querySelector('#portal').addEventListener('mouseenter', function(){
        $(this).css('z-index','99999');
        $('#overlay').fadeIn(1000);
        document.querySelector('#portal').emit('next_page')

        $(this).data('timeout', setTimeout(function(){
          window.open("win.html", "_self")
        }, 1000));
        $('#overlay').fadeOut(1000);
      })

      // Bad coin
      function BadAnswerOne() {
          coin2.emit('select')
          $(this).data('timeout', setTimeout(function(){
            coin1.removeEventListener('mouseenter', correctAnswer);
            coin2.removeEventListener('mouseenter', BadAnswerOne);
            coin3.removeEventListener('mouseenter', BadAnswerTwo);
            document.querySelector('#bad_portal').setAttribute('visible', true)
            document.querySelector('#bad_portal').emit('expand')
          }, 2000));
      }

      function BadAnswerOneLeave() {
        coin2.emit('deselect')
        clearTimeout($(this).data('timeout'));
      }

      function BadAnswerTwo() {
          coin3.emit('select')
          $(this).data('timeout', setTimeout(function(){
            coin1.removeEventListener('mouseenter', correctAnswer);
            coin2.removeEventListener('mouseenter', BadAnswerOne);
            coin3.removeEventListener('mouseenter', BadAnswerTwo);
            document.querySelector('#bad_portal').setAttribute('visible', true)
            document.querySelector('#bad_portal').emit('expand')
          }, 2000));
      }

      function BadAnswerTwoLeave() {
        coin3.emit('deselect')
        clearTimeout($(this).data('timeout'));
      }

      // Correct answer redirect
      document.querySelector('#bad_portal').addEventListener('mouseenter', function(){
        $(this).css('z-index','99999');
        $('#wrong_overlay').fadeIn(1000);
        document.querySelector('#bad_portal').emit('next_page')

        $(this).data('timeout', setTimeout(function(){
          window.open("tryagain.html", "_self")
        }, 1000));
        $('#wrong_overlay').fadeOut(1000);
      })

      coin2.addEventListener('mouseenter', BadAnswerOne);
      coin3.addEventListener('mouseenter', BadAnswerTwo);

      coin2.addEventListener('mouseleave', BadAnswerOneLeave);
      coin3.addEventListener('mouseleave', BadAnswerTwoLeave);

      </script>
    </body>
</html>
