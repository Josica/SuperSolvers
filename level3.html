<!DOCTYPE html>
<html>
    <head>
        <script src="https://aframe.io/releases/0.5.0/aframe.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
        <script src="https://unpkg.com/aframe-layout-component@3.x.x/dist/aframe-layout-component.min.js"></script>
        <script src="./aframe-particle-system-component.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Denk+One" rel="stylesheet">
    </head>

    <body>
      <a-scene inspector="url: https://aframe.io/releases/0.3.0/aframe-inspector.min.js">
        <a-assets>
          <a-asset-item id='object' src='models/mnts/mountains.obj'></a-asset-item>
          <a-asset-item id='material' src='models/mnts/mountains.mtl'></a-asset-item>
          <a-asset-item id='lion-obj' src='models/lion/lion-cub.obj'></a-asset-item>
          <a-asset-item id='lion-mtl' src='models/lion/lion-cub.mtl'></a-asset-item>
        </a-assets>

        <!-- ========= Screen Blackout ========= -->
        <div id='overlay' style='background: white; display: none; width: 100%; height: 100%; position:absolute; top:0; left:0; z-index:99998;'></div>

        <div id='wrong_overlay' style='background: black; display: none; width: 100%; height: 100%; position:absolute; top:0; left:0; z-index:99998;'></div>

        <!-- ========= Screen load ========= -->
        <div id='loader' style='position: fixed; left: 0px; top: 0px; width: 100%; height: 100%; z-index: 9999; background-color: white; text-align: center;'>
          <img id='img'src='img/logo-supersolvers.png' style="height: 200px; margin-top: 10%"></img>
          <p style="font-size: 20px; font-family: 'Denk One', sans-serif;">Loading...</p>
        </div>

        <!-- ========= Snow ========= -->
        <a-entity position="0 2.25 -15" particle-system="preset: snow"></a-entity>

        <!-- ========= Objects ========= -->
        <a-obj-model src='#object' mtl='#material' position='-77 20 -140' rotation='0 120 0'></a-obj-model>
        <a-obj-model src='#object' mtl='#material' position='150 20 -122' rotation='0 50 0'></a-obj-model>
        <a-obj-model id='move' src='#object' mtl='#material' position='-132 20 -12' rotation='0 220 0'></a-obj-model>
        <a-obj-model src='#object' mtl='#material' position='250 20 35.94' rotation='0 190 0'></a-obj-model>
        <a-obj-model src='#object' mtl='#material' position='98.20 20 134.31' rotation='0 270 0'></a-obj-model>
        <a-obj-model id='lion' src="#lion-obj" mtl="#lion-mtl" rotation="180 10 180" position="-2 3.4 -35"></a-obj-model>

        <!-- ========= Floor ========= -->
        <a-plane color='white' src='models/snow.jpg' height='300' width='400' rotation='-90 0 0' position='54 0 0'></a-plane>

        <!-- ========= Lion text ========= -->
        <a-entity id='text' scale='8 8 8'geometry="primitive: plane; width: 2 auto; height: 1; " visible='false' text="value: Brrr! It's pretty cold here... \n Looks like we need to do some calculations to get to the next portal! ; align: center; width: 1.6; wrap-count: 20; color: #333333" position="0 13 -33" rotation='0 5 0' material="color: white" >
          <a-animation
           attribute="scale"
           dur="500"
           from="0.1 0.1 0.1"
           to="8 8 8"
           easing="linear"
           begin="text_expand">
         </a-animation>
        </a-entity>

      <!-- ========= Ice Geometry Models ========= -->
      <!-- Ice box 1 -->
      <a-box visible='false' id='ice' height='15' src='models/ice.jpg' width='10' depth='1' position='25 0 -30' rotation='0 -30 0'>
        <a-animation
         attribute="scale"
         dur="2000"
         from="0.1 0.1 0.1"
         to="1 1 1"
         easing="linear"
         begin="grow_ice">
       </a-animation>
      </a-box>
        <a-entity class='ice_text' visible='false' geometry='primitive: plane; width: 4; height: 1.3' material='color: black' position='4.2 11.7 -5' text='value: Height: 1ft, Width: 1ft; width: 8; align: center; color: white' rotation='0 -40 0'>
        </a-entity>

      <!-- Ice box 2 -->
      <a-box visible='false' height='30' src='models/ice.jpg' width='30' depth='3' position='-15 1 71' rotation='0 0 0'></a-box>
        <a-entity class='ice_text' visible='false' geometry='primitive: plane; width: 3; height: .9' material='color: black' position='-1 12.1 4' text='value: Height: 3ft, Width: 4ft; width: 6; align: center; color: white' rotation='0 170 0'>
        </a-entity>

      <!-- Ice box 3 -->
      <a-box visible='false' height='8' src='models/ice.jpg' width='22' depth='3' position='-30 3 -10' rotation='0 95 0'></a-box>
        <a-entity class='ice_text' visible='false' geometry='primitive: plane; width: 2.9; height: .9' material='color: black' position='-4 11.3 -1.3' text='value: Height: 1ft, Width: 3ft; width: 6; align: center; color: white' rotation='0 85 0'>
        </a-entity>

      <!-- ========= Math Equation ========= -->
      <a-entity id='equation' scale='30 30 30'geometry="primitive: plane; width: 1.1; height: .5" visible='false' text="value: What is the combined PERIMETER - or the sum of every side - of all 3 ice blocks combined?; align: center; width: 1.1; wrap-count: 20; color: #333333" position="65 20 9.3" rotation='0 -90 0' material="color: white" >
        <a-animation
         attribute="scale"
         dur="1000"
         from="0.1 0.1 0.1"
         to="8 8 8"
         easing="linear"
         begin="text_expand">
       </a-animation>
      </a-entity>

      <!-- ========= Text for Answers ========= -->
      <a-text class='a_text' visible='false' width='100' value='26' rotation='0 -90 0' color='black' position='83 55 23'>
        <a-animation
           attribute="width"
           dur="2000"
           from="0"
           to="100"
           easing="linear"
           begin="number">
        </a-animation>
      </a-text>
      <a-text class='a_text' visible='false' width='100' value='20' rotation='0 -90 0' color='black' position='83 55 10.3'>
        <a-animation
           attribute="width"
           dur="2000"
           from="0"
           to="100"
           easing="linear"
           begin="number">
        </a-animation>
      </a-text>
      <a-text class='a_text' visible='false' width='100' value='30' rotation='0 -90 0' color='black' position='83 55 -2'>
        <a-animation
           attribute="width"
           dur="2000"
           from="0"
           to="100"
           easing="linear"
           begin="number">
        </a-animation>
      </a-text>

      <!-- ========= Portal ========= -->
      <a-sphere id='portal' src='models/portal.png' visible="false" position="20 7 24" radius="0.5" scale="0.1 0.1 0.1">
        <a-animation
            attribute="rotation"
             dur="500"
             from="0 0 0"
             to="0 360 0"
             repeat="indefinite"
             easing="linear"></a-animation>

         <a-animation
          attribute="scale"
          dur="2000"
          from="0.1 0.1 0.1"
          to="7 14 7"
          easing="linear"
          begin="expand">
        </a-animation>

        <a-animation
         attribute="position"
         dur="1000"
         from="20 7 24"
         to="2 7 3"
         easing="linear"
         begin="next_page">
       </a-animation>
      </a-sphere>

      <!-- Wrong portal -->
      <a-sphere id='bad_portal' color='black' src='models/portal.png' visible="false" position="20 7 24" radius="0.5" scale="0.1 0.1 0.1">
        <a-animation
            attribute="rotation"
             dur="500"
             from="0 0 0"
             to="0 360 0"
             repeat="indefinite"
             easing="linear"></a-animation>

         <a-animation
          attribute="scale"
          dur="2000"
          from="0.1 0.1 0.1"
          to="7 14 7"
          easing="linear"
          begin="expand">
        </a-animation>

        <a-animation
         attribute="position"
         dur="1000"
         from="20 7 24"
         to="2 7 3"
         easing="linear"
         begin="next_page">
       </a-animation>
      </a-sphere>

      <!-- ========= Answers ========= -->
      <a-entity id="answers" layout="type: line; margin: 12" visible= 'false'  rotation='0 90 0'>
      <!-- Correct answer -->
        <a-sphere id='answer1' radius='4' color="white">

          <a-animation
             attribute="radius"
             dur="2000"
             from="4 "
             to="6"
             easing="linear"
             begin="select">
          </a-animation>

          <a-animation
             attribute="radius"
             dur="2000"
             from="4"
             to="4"
             easing="linear"
             begin="deselect">
          </a-animation>
        </a-sphere>

        <!-- Incorrect answer -->
        <a-sphere id='answer2' radius=4 color="white">
          <a-animation
             attribute="radius"
             dur="2000"
             from="4 "
             to="6"
             easing="linear"
             begin="select">
          </a-animation>

          <a-animation
             attribute="radius"
             dur="2000"
             from="4"
             to="4"
             easing="linear"
             begin="deselect">
          </a-animation>
        </a-sphere>

        <!-- Incorrect answer -->
        <a-sphere id='answer3' radius=4 color="white">
          <a-animation
             attribute="radius"
             dur="2000"
             from="4 "
             to="6"
             easing="linear"
             begin="select">
          </a-animation>

          <a-animation
             attribute="radius"
             dur="2000"
             from="4"
             to="4"
             easing="linear"
             begin="deselect">
          </a-animation>
        </a-sphere>

        <!-- spheres appear animation -->
        <a-animation
         attribute="scale"
         dur="2000"
         from="0.1 0.1 0.1"
         to="1 1 1"
         easing="linear"
         begin="solve1">
        </a-animation>

        <a-animation
           attribute="position"
           dur="2000"
           from="80 15 20"
           to="80 45 25"
           easing="linear"
           begin="solve2">
        </a-animation>
      </a-entity>

        <a-sky src="models/sky.jpg"></a-sky>

        <a-camera position='0 9 0'>
          <a-cursor color='red'></a-cursor>
        </a-camera>
      </a-scene>

      <script>
      // Start loading screen
        $(window).load(function() {
          $("#img").fadeIn("slow");
          $(this).data('timeout', setTimeout(function(){
            $("#loader").fadeOut("slow");
          }, 2000))
        })

      // Start text pop-up
      var lion = document.querySelector('#lion')
      var text = document.querySelector('#text')
      var eq = document.querySelector('#equation')
      var answer1 = document.querySelector('#answer1')
      var answer2 = document.querySelector('#answer2')
      var answer3 = document.querySelector('#answer3')
      var boxes = document.querySelectorAll('a-box')
      var iceTexts = document.querySelectorAll('.ice_text')
      var numbers = document.querySelectorAll('.a_text')
      var portal = document.getElementById('portal')
      var badPortal = document.getElementById('bad_portal')
      var ice = document.getElementById('ice')

        lion.addEventListener( 'mouseenter', function() {
          text.setAttribute("visible", true)
          text.emit('text_expand')
          eq.setAttribute("visible", true)
          ice.emit('grow_ice')

        })
        lion.addEventListener( 'mouseleave', function() {
          text.setAttribute("visible", false)
        });

        function answersShow(){
            answers.setAttribute('visible', true)
            answers.emit('solve1')
            answers.emit('solve2')
            $(this).data('timeout', setTimeout(function(){
              numbers.forEach(function(number){
                number.setAttribute('visible', true)
              })
            }, 2000))
            boxes.forEach(function(box){
              box.setAttribute('visible', true)
            })
          eq.removeEventListener('mouseenter', answersShow);
        }

        eq.addEventListener('mouseenter', answersShow);

        // Correct answer action
        function correctAnswer() {
            answer1.emit('select')
            $(this).data('timeout', setTimeout(function(){
              answer1.setAttribute('color', '#7AB800')
              answer2.setAttribute('color', 'red')
              answer3.setAttribute('color', 'red')
              eq.setAttribute('text', 'value', 'Correct!')
              eq.setAttribute('text', 'color', 'white')
              eq.setAttribute('material', 'color', '#7AB800')
              answer1.removeEventListener('mouseenter', correctAnswer);
              document.querySelector('#portal').setAttribute('visible', true)
              document.querySelector('#portal').emit('expand')
            }, 2000));
        }

        function correctAnswerLeave() {
          answer1.emit('deselect')
          clearTimeout($(this).data('timeout'));
        }

        answer1.addEventListener('mouseenter', correctAnswer);
        answer1.addEventListener('mouseleave', correctAnswerLeave);


        // Bad answer
        function BadAnswerOne(e) {
            answer2.emit('select')
            $(this).data('timeout', setTimeout(function(){
              answer2.setAttribute('color', 'red')
              answer3.setAttribute('color', 'red')
              answer1.setAttribute('color', '#7AB800')
              eq.setAttribute('text', 'color', 'white')
              eq.setAttribute('text', 'value', 'Ohh sorry!')
              eq.setAttribute('material', 'color', '#F23127')
              answer1.removeEventListener('mouseenter', correctAnswer);
              answer2.removeEventListener('mouseenter', BadAnswerOne);
              answer3.removeEventListener('mouseenter', BadAnswerTwo);
              document.querySelector('#bad_portal').setAttribute('visible', true)
              document.querySelector('#bad_portal').emit('expand')
            }, 2000));
        }

        function BadAnswerOneLeave() {
          answer2.emit('deselect')
          clearTimeout($(this).data('timeout'));
        }

        function BadAnswerTwo(e) {
            answer3.emit('select')
            $(this).data('timeout', setTimeout(function(){
              answer2.setAttribute('color', 'red')
              answer3.setAttribute('color', 'red')
              answer1.setAttribute('color', '#7AB800')
              eq.setAttribute('text', 'value', 'Ohh sorry!')
              eq.setAttribute('text', 'color', 'white')
              eq.setAttribute('material', 'color', '#F23127')
              answer1.removeEventListener('mouseenter', correctAnswer);
              answer2.removeEventListener('mouseenter', BadAnswerOne);
              answer3.removeEventListener('mouseenter', BadAnswerTwo);
              document.querySelector('#bad_portal').setAttribute('visible', true)
              document.querySelector('#bad_portal').emit('expand')
            }, 2000));
        }

        function BadAnswerTwoLeave() {
          answer3.emit('deselect')
          clearTimeout($(this).data('timeout'));
        }

        answer2.addEventListener('mouseenter', BadAnswerOne);
        answer3.addEventListener('mouseenter', BadAnswerTwo);

        answer2.addEventListener('mouseleave', BadAnswerOneLeave);
        answer3.addEventListener('mouseleave', BadAnswerTwoLeave);

        boxes.forEach(function(box){
          box.addEventListener( 'mouseenter', function() {
            iceTexts.forEach(function(text){
              text.setAttribute('visible', true)
            })
          })
          box.addEventListener( 'mouseleave', function() {
            iceTexts.forEach(function(text){
              text.setAttribute('visible', false)
            })
          });
        })

        // Portal Redirect to Next Page
        portal.addEventListener('mouseenter', function(event){
          $(this).css('z-index','99999');
          $('#overlay').fadeIn(1000);
          portal.emit('next_page')

          $(this).data('timeout', setTimeout(function(){
            window.open("level4.html", "_self")
          }, 1000));
          $('#overlay').fadeOut(1000);
        });

        badPortal.addEventListener('mouseenter', function(event){
          $(this).css('z-index','99999');
          $('#wrong_overlay').fadeIn(1000);
          badPortal.emit('next_page')

          $(this).data('timeout', setTimeout(function(){
            window.open("tryagain.html", "_self")
          }, 1000));
          $('#wrong_overlay').fadeOut(1000);
        });

      </script>
    </body>
</html>
