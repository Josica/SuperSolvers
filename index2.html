<!DOCTYPE html>
<html>
    <head>
        <script src="https://aframe.io/releases/0.5.0/aframe.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
        <script src="https://unpkg.com/aframe-layout-component@3.x.x/dist/aframe-layout-component.min.js"></script>
        <script src="./aframe-particle-system-component.js"></script>
    </head>
    <body>
      <a-scene inspector="url: https://aframe.io/releases/0.3.0/aframe-inspector.min.js">
        <a-assets>
          <a-asset-item id='object' src='models/mnts/mountains.obj'></a-asset-item>
          <a-asset-item id='material' src='models/mnts/mountains.mtl'></a-asset-item>
          <a-asset-item id='lion-obj' src='models/lion/lion-cub.obj'></a-asset-item>
          <a-asset-item id='lion-mtl' src='models/lion/lion-cub.mtl'></a-asset-item>
        </a-assets>

        <!-- ========= Snow ========= -->
        <a-entity position="0 2.25 -15" particle-system="preset: snow"></a-entity>

        <!-- ========= Objects ========= -->
        <a-obj-model src='#object' mtl='#material' position='-77 20 -140' rotation='0 120 0'></a-obj-model>
        <a-obj-model src='#object' mtl='#material' position='150 20 -122' rotation='0 50 0'></a-obj-model>
        <a-obj-model id='move' src='#object' mtl='#material' position='-132 20 -12' rotation='0 220 0'></a-obj-model>
        <a-obj-model src='#object' mtl='#material' position='250 20 35.94' rotation='0 190 0'></a-obj-model>
        <a-obj-model src='#object' mtl='#material' position='98.20 20 134.31' rotation='0 270 0'></a-obj-model>
        <a-obj-model id='lion' src="#lion-obj" mtl="#lion-mtl" rotation="180 10 180" position="-2 3.4 -35"></a-obj-model>

        <!-- ========= Floor ========= -->
        <a-plane color='white' src='models/snow.jpg' height='300' width='400' rotation='-90 0 0' position='54 0 0'></a-plane>

        <!-- ========= Lion text ========= -->
        <a-entity id='text' scale='8 8 8'geometry="primitive: plane; width: 2 auto; height: 1; " visible='false' text="value: I have no idea why we're here, let's do some calculations to get us out of here! ; align: center; width: 1.6; wrap-count: 20; color: #333333" position="0 13 -33" rotation='0 -5 0' material="color: white" >
          <a-animation
           attribute="scale"
           dur="500"
           from="0.1 0.1 0.1"
           to="8 8 8"
           easing="linear"
           begin="text_expand">
         </a-animation>
        </a-entity>

      <!-- ========= Ice ice baby ========= -->
      <a-box visible='false' height='15' src='models/ice.jpg' width='10' depth='3' position='25 0 -57' rotation='0 0 0'></a-box>
        <a-text class='ice_text' visible='false' width='70' value='Height: 1ft, Width: 1ft' position='12 12 -57'></a-text>
      <a-box visible='false' height='30' src='models/ice.jpg' width='30' depth='3' position='-15 1 71' rotation='0 0 0'></a-box>
        <a-text class='ice_text' visible='false' width='100' value='Height: 3ft, Width: 4ft' rotation='0 180 0' position='5 21 71'></a-text>
      <a-box visible='false' height='9' src='models/ice.jpg' width='22' depth='3' position='-85 4 -22' rotation='0 95 0'></a-box>
        <a-text class='ice_text' visible='false' width='130' value='Height: 1ft, Width: 3ft' rotation='0 85 0' position='-85 15 3'></a-text>



      <!-- ========= Math equation ========= -->
      <a-entity id='equation' scale='30 30 30'geometry="primitive: plane; width: 1.1; height: .5" visible='false' text="value: What is the combined perimeter of the 3 ice blocks; align: center; width: 1.1; wrap-count: 20; color: #333333" position="65 20 9.3" rotation='0 -90 0' material="color: white" >
        <a-animation
         attribute="scale"
         dur="1000"
         from="0.1 0.1 0.1"
         to="8 8 8"
         easing="linear"
         begin="text_expand">
       </a-animation>
      </a-entity>

      <!-- ========= Text for Answers ========= -->
      <a-text class='a_text' visible='false' width='100' value='20' rotation='0 -90 0' color='black' position='83 55 23'>
        <a-animation
           attribute="width"
           dur="2000"
           from="0"
           to="100"
           easing="linear"
           begin="number">
        </a-animation>
      </a-text>
      <a-text class='a_text' visible='false' width='100' value='26' rotation='0 -90 0' color='black' position='83 55 10.3'>
        <a-animation
           attribute="width"
           dur="2000"
           from="0"
           to="100"
           easing="linear"
           begin="number">
        </a-animation>
      </a-text>
      <a-text class='a_text' visible='false' width='100' value='30' rotation='0 -90 0' color='black' position='83 55 -2'>
        <a-animation
           attribute="width"
           dur="2000"
           from="0"
           to="100"
           easing="linear"
           begin="number">
        </a-animation>
      </a-text>

      <!-- ========= Answers ========= -->
      <a-entity id="answers" layout="type: line; margin: 12" visible= 'false'  rotation='0 90 0'>
      <!-- Correct answer -->
        <a-sphere id='answer1' radius='4' color="white">
          <!-- <a-text value="Hello World!" position="0 3 0"> </a-text> -->
          <a-animation
             attribute="radius"
             dur="2000"
             from="4 "
             to="6"
             easing="linear"
             begin="select">
          </a-animation>

          <a-animation
             attribute="radius"
             dur="2000"
             from="4"
             to="4"
             easing="linear"
             begin="deselect">
          </a-animation>
        </a-sphere>

        <!-- Incorrect answer -->
        <a-sphere id='answer2' radius=4 color="white">
          <a-animation
             attribute="radius"
             dur="2000"
             from="4 "
             to="6"
             easing="linear"
             begin="select">
          </a-animation>

          <a-animation
             attribute="radius"
             dur="2000"
             from="4"
             to="4"
             easing="linear"
             begin="deselect">
          </a-animation>
        </a-sphere>

        <!-- Incorrect answer -->
        <a-sphere id='answer3' radius=4 color="white">
          <a-animation
             attribute="radius"
             dur="2000"
             from="4 "
             to="6"
             easing="linear"
             begin="select">
          </a-animation>

          <a-animation
             attribute="radius"
             dur="2000"
             from="4"
             to="4"
             easing="linear"
             begin="deselect">
          </a-animation>
        </a-sphere>

        <!-- spheres appear animation -->
        <a-animation
         attribute="scale"
         dur="2000"
         from="0.1 0.1 0.1"
         to="1 1 1"
         easing="linear"
         begin="solve1">
        </a-animation>

        <a-animation
           attribute="position"
           dur="2000"
           from="80 15 20"
           to="80 45 25"
           easing="linear"
           begin="solve2">
        </a-animation>
      </a-entity>

        <a-sky src="models/sky.jpg"></a-sky>

        <a-camera position='0 9 0'>
          <a-cursor color='red'></a-cursor>
        </a-camera>
      </a-scene>



      <script>
      // Start text pop-up
      var lion = document.querySelector('#lion')
      var text = document.querySelector('#text')
      var eq = document.querySelector('#equation')
      var answer1 = document.querySelector('#answer1')
      var answer2 = document.querySelector('#answer2')
      var answer3 = document.querySelector('#answer3')
      var boxes = document.querySelectorAll('a-box')
      var iceTexts = document.querySelectorAll('.ice_text')
      var numbers = document.querySelectorAll('.a_text')

        lion.addEventListener( 'mouseenter', function() {
          text.setAttribute("visible", true)
          text.emit('text_expand')
          eq.setAttribute("visible", true)
        })
        lion.addEventListener( 'mouseleave', function() {
          text.setAttribute("visible", false)
        });

        function answersShow(){
            answers.setAttribute('visible', true)
            answers.emit('solve1')
            answers.emit('solve2')
            numbers.forEach(function(number){
              number.setAttribute('visible', true)
              number.emit('number')
            })
            boxes.forEach(function(box){
              box.setAttribute('visible', true)
            })
          eq.removeEventListener('mouseenter', answersShow);
        }

        eq.addEventListener('mouseenter', answersShow);

        // Correct answer action
        function correctAnswer() {
            answer1.emit('select')
            $(this).data('timeout', setTimeout(function(){
              answer1.setAttribute('color', '#7AB800')
              answer2.setAttribute('color', 'red')
              answer3.setAttribute('color', 'red')
              eq.setAttribute('text', 'value', 'Correct!')
              eq.setAttribute('text', 'color', 'white')
              eq.setAttribute('material', 'color', '#7AB800')
              answer1.removeEventListener('mouseenter', correctAnswer);
            }, 2000));
        }

        function correctAnswerLeave() {
          answer1.emit('deselect')
          clearTimeout($(this).data('timeout'));
        }

        answer1.addEventListener('mouseenter', correctAnswer);
        answer1.addEventListener('mouseleave', correctAnswerLeave);


        // Bad answer
        function BadAnswerOne(e) {
            answer2.emit('select')
            $(this).data('timeout', setTimeout(function(){
              answer2.setAttribute('color', 'red')
              answer3.setAttribute('color', 'red')
              answer1.setAttribute('color', '#7AB800')
              eq.setAttribute('text', 'color', 'white')
              eq.setAttribute('text', 'value', 'Ohh sorry!')
              eq.setAttribute('material', 'color', '#F23127')
              answer1.removeEventListener('mouseenter', correctAnswer);
              answer2.removeEventListener('mouseenter', BadAnswerOne);
              answer3.removeEventListener('mouseenter', BadAnswerTwo);
            }, 2000));
        }

        function BadAnswerOneLeave() {
          answer2.emit('deselect')
          clearTimeout($(this).data('timeout'));
        }

        function BadAnswerTwo(e) {
            answer3.emit('select')
            $(this).data('timeout', setTimeout(function(){
              answer2.setAttribute('color', 'red')
              answer3.setAttribute('color', 'red')
              answer1.setAttribute('color', '#7AB800')
              eq.setAttribute('text', 'value', 'Ohh sorry!')
              eq.setAttribute('text', 'color', 'white')
              eq.setAttribute('material', 'color', '#F23127')
              answer1.removeEventListener('mouseenter', correctAnswer);
              answer2.removeEventListener('mouseenter', BadAnswerOne);
              answer3.removeEventListener('mouseenter', BadAnswerTwo);
            }, 2000));
        }

        function BadAnswerTwoLeave() {
          answer3.emit('deselect')
          clearTimeout($(this).data('timeout'));
        }

        answer2.addEventListener('mouseenter', BadAnswerOne);
        answer3.addEventListener('mouseenter', BadAnswerTwo);

        answer2.addEventListener('mouseleave', BadAnswerOneLeave);
        answer3.addEventListener('mouseleave', BadAnswerTwoLeave);

        boxes.forEach(function(box){
          box.addEventListener( 'mouseenter', function() {
            iceTexts.forEach(function(text){
              text.setAttribute('visible', true)
            })
          })
          box.addEventListener( 'mouseleave', function() {
            iceTexts.forEach(function(text){
              text.setAttribute('visible', false)
            })
          });
        })


      </script>
    </body>
</html>
